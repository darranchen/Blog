---
layout: post
title: Git 初步了解《Pro Git 中文版》（一）
tagline: 《Pro Git 中文版》
date: 2014-04-28
categories: Book
tags:  git book
keywords:  git Note 
discription:  这是Pro Git 的中文版读书笔记
---


首先需要讲下为什么要认真把这本《Pro Git》读完，其实如果只是掌握几个上传的基本指令，那么一下就能够学完了， 但是Git 开发的动力点就是用于做代码管理，在做论文的时候也会有这种感觉，就是论文的代码写了改，改完写，有时候想要找到原始的版本都找不到，如果自己有时候想要修改会原始的状态都找很久，Git 就是用来解决这个问题的，而且Git 支持多人开发，如果有天需要和人合作了，那么这就是很好的工具，所以先学习起来, 还有一个重要的原因是，一个非常成功的工具它背后有很多思想需要去学习，所以就先学起来了。

## 1.1 版本控制

保存之前代码的过程术语说起来就是版本控制. 版本控制的历史可以追溯为三个阶段：

### 本地版本控制系统 

说白了这就是人工复制粘帖，优点就是简单易行，缺点就是很容易混淆文件目录

### 集中化的版本控制系统

集中化的版本控制(Centralized Version Control System, 简称CVSC）就是有一个集中管理的服务器，然后服务器是保存最新更新的文档版本。如图1-2所示 ![1-2][], 不同的用户共享一个服务器，每次都将各自的最新版本发送的服务端，这样的优点是每次可以知道不同用户的状况，但是缺点也很明显，就是只有一个中央管理系统，一旦它瘫痪了怎么办，如果服务端的资料丢失，那么造成的后果就是文件找不回来了。

### 分布式版本控制系统

接下来就是要学习 Git这类的分布式版本管理系统, 一改原来只有一个文件管理系统的问题，这次每一个用户都有系统的版本，如图 ![1-3][] 所示，这样子所有的操作都可以在本地执行，之后再传到远端的系统上面做比较，修改。

## Git 基础想法

接下来开始学习Git 的基础想法，先了解一下Git 当初开发的几个基本目标

* 速度
* 简单的设计
* 对非线性开发模式的强力支持(允许上千个并行开发的分支)
* 完全分布式
* 有能力高校管理类似Linux 内核一样的超大规模项目

其实上面的目标都是为了有更加人性化的开发环境，这里简单和速度是和现有的做比较，因为本身要处理的问题已经很复杂了，但是就是要让人使用起来尽可能简单。

### Git 文件记录方式

Git 的文件记录方式是直接记录快照，这是什么意思呢，直接记录快照其实是直接记录下整个文档，有修改过的记录修改的版本，没有修改过的使用一个类似指针的指向原来文档的位置，这样节省空间又有效率. 比较一下Git跟其他控制系统的差别。 

* 直接记录快照，而非差异比较

其他的系统主要是关注文件内容的具体差异，记录下每次文档更新了那些行的内容，如图1-4 ![1-4][],可以看到，每个新的版本就是记录下上次与这次的区别，把新版本的文档更新的内容保留下来

但是Git 并没有保留这次变化的内容，而是直接做一个快照，直接把文档保留下来，如果有修改，那么就保留文档，如果没有修改就是对上一次的快照做一次链接过去，其实就像指针一样，这样可以性能就可以提高，这个说是最关键的区别，因为每一次更新其实像是保留了每一个文档，那么就可以以此为基础做很多操作， 如1-5 所示 ![1-5][]

* 时刻保持数据完整行

Git怎么保证数据的完整性呢，就是对于所有数据都做了一个校验和计算，对于文档保持到Git 之前，文档都会做一个校验和计算，如果数据在传输过程中变得不完整Git 就会计算一次校验码，如果不同就是有丢失，可以重传。 Git的工作完全是依靠SHA-1计算数据的校验和，返回一个40个十六进制的字符。 这是文档的类似身份证一样的东西，所以在Git数据库中的操作都是依靠这个Hash 码， 而不是文件名.

* 多数操作仅仅是添加数据

Git 的多个操作就是添加一下数据到数据库，而不是去删除文档，除非是自己去删除数据，不然提交快照之后就不怕丢失数据了，这个是很强的优点。

* 文档三种状态

我们是对文档进行编辑的，那么需要了解文档的基本状态，来确定我们需要对文档做什么操作或者文档被做了什么操作。一般文档在Git 内有三个状态，其实如果加上我们整个工作目录应该有四种状态，

* 未追踪: 就是没有提交过这个文档，Git并没有这个文档的快照之类的
* 已修改: 就是已经修改过的文档，但是还没有提交保存到暂存区域
* 已暂存: 就是修改过的文档已经提交到暂存区域，准备下次保存到本地仓库
* 已提交: 就是已经提交到本地的仓库了

其实上面提到了几个重要的概念，就是文档是存在不同的区域的，那么实际用Git 管理项目的时候有几个区域呢，有三个区域，一个是工作目录，就是目前操作下的目录，另一个是暂存区域，是用来暂时储存文件快照的区域，其实它更像一个索引文件，一般都会放在 `.git `目录下, 最后是本地仓库，就是储存当地文件版本的区域. 这种三级的管理系统可以确保中间可以有修改的过程，而不会直接就修改仓库。 我又觉得还有一个区块，就是远端仓库.如图1-6 ![1-6][]

Git的工作流程如下:

1. 在文件目录中修改某些文件或者增加某些文件
2. 对修改的文件做快照，保存到暂存区域 `git add <file>`.
3. 提交更新，将暂存在暂存区域的文件快照转存到 git 目录下.`git commmit -m "">`

## 用户信息配置

初次使用Git 需要配置个人信息，因为我们每次更新文档都会记录我们的个人信息，所以配置一下个人信息，首先看下Git 配置信息存储的三个位置：

* /etc/gitconfig 文件, 这个是系统对所有用户普遍的配置 如果修改需要用 --system 这个选项. 比如 `git config --system user.name "xinjie"`
* ~/.gitconfig 文件，就是当前用户的配置，修改用--global 这个选项
* .git/config 就是当前项目下面的配置文档，如果不加选项就是默认修改这个。


比较关键需要修改的配置信息有

* 用户信息

因为每次提交都需要提交个人信息，所以需要修改用户信息，可以用

{% highlight bash%}
$ git config --global user.name "xinjie"
$ git config --global user.email zsdxchenxinjie@gmail.com
{% endhighlight %}

* 文件编辑器

这里有时候需要使用文件编辑器,比如我们在 `git commit`的时候如果没有加入 `-m`选项就会让我们编辑信息提交，所以会有默认的文件编辑器，我喜欢用vim，默认也是vim，如果是要用Emacs的话，可以用

{% highlight bash%}
$ git config --global core.editor emacs
{% endhighlight %}

* 差异分析工具

当解决合并冲突时会需要使用差异分析工具，来显示哪一个代码是有差别的，如果要使用vimdiff 的话，可以用：


{% highlight bash%}
$ git config --global merge.tool vimdiff
{% endhighlight %}

* 查看配置信息

检查已有的配置信息

{% highlight bash%}
$ git config --list 
{% endhighlight %}

我list 出来的信息是

{% highlight bash%}
darran@darran:~/darrangithubproject$ git config --list
user.name=darranchen
user.email=zsdxchenxinjie@gmail.com
user.token=chendadi
core.editor=vim
merge.tool=vimdiff
core.repositoryformatversion=0
core.filemode=true
core.bare=false
core.logallrefupdates=true
remote.origin.url=https://github.com/darranchen/Blog.git
remote.origin.fetch=+refs/heads/*:refs/remotes/origin/*
{% endhighlight %}

也可以直接只看一个你想要看的信息，如：

{% highlight bash%}
$ git config user.name
{% endhighlight %}


[1-2]: {{BASE_PATH}}/images/Pro_Git/1-2.png
[1-3]: {{BASE_PATH}}/images/Pro_Git/1-3.png
[1-4]: {{BASE_PATH}}/images/Pro_Git/1-4.png
[1-5]: {{BASE_PATH}}/images/Pro_Git/1-5.png
[1-6]: {{BASE_PATH}}/images/Pro_Git/1-6.png
